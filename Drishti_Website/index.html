<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>DRISHTI 2.0 | National AI Grievance Platform</title>
    <script src="https://cdn.tailwindcss.com"></script>
    <script src="https://unpkg.com/lucide@latest"></script>
    <script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
    <style>
        @import url('https://fonts.googleapis.com/css2?family=Inter:wght@300;400;500;600;700&family=Public+Sans:wght@400;600;700;800&display=swap');
        
        :root {
            --gov-blue: #0b4a8f;
            --gov-dark: #072a53;
            --gov-saffron: #f39200;
            --gov-green: #2e7d32;
            --gov-light: #f8fafc;
        }

        body {
            font-family: 'Public Sans', sans-serif;
            background-color: var(--gov-light);
            color: #1e293b;
            height: 100vh;
        }

        .gov-card {
            background: white;
            border-radius: 1rem;
            box-shadow: 0 4px 20px -2px rgba(0,0,0,0.05);
            border: 1px solid #e2e8f0;
            transition: transform 0.2s, box-shadow 0.2s;
        }

        .gov-card:hover {
            box-shadow: 0 10px 30px -5px rgba(0,0,0,0.08);
        }

        .gradient-header {
            background: linear-gradient(135deg, #0b4a8f 0%, #072a53 100%);
        }

        .sidebar-item {
            display: flex;
            align-items: center;
            gap: 1rem;
            padding: 0.85rem 1.5rem;
            transition: all 0.25s cubic-bezier(0.4, 0, 0.2, 1);
            color: #94a3b8;
            cursor: pointer;
            border-left: 4px solid transparent;
        }

        .sidebar-item:hover {
            background: rgba(255,255,255,0.08);
            color: white;
        }

        .sidebar-item.active {
            background: rgba(255,255,255,0.12);
            color: white;
            border-left-color: var(--gov-saffron);
            font-weight: 700;
        }

        .status-pill {
            padding: 0.35rem 0.85rem;
            border-radius: 2rem;
            font-size: 0.7rem;
            font-weight: 800;
            letter-spacing: 0.025em;
            text-transform: uppercase;
        }

        .timeline-line {
            position: absolute;
            left: 1.25rem;
            top: 2rem;
            bottom: -1rem;
            width: 2px;
            background: #e2e8f0;
        }

        .ai-glow {
            box-shadow: 0 0 15px rgba(243, 146, 0, 0.3);
            border: 1px solid rgba(243, 146, 0, 0.5);
        }

        .custom-scrollbar::-webkit-scrollbar {
            width: 6px;
        }
        .custom-scrollbar::-webkit-scrollbar-thumb {
            background: #cbd5e1;
            border-radius: 10px;
        }

        @keyframes fadeIn {
            from { opacity: 0; transform: translateY(10px); }
            to { opacity: 1; transform: translateY(0); }
        }
        .animate-view { animation: fadeIn 0.4s ease-out forwards; }
    </style>
</head>
<body class="antialiased overflow-hidden flex flex-col">

<div id="app" class="flex-1 flex flex-col overflow-hidden">
    <!-- Platform Simulator Top Bar -->
    <div class="bg-slate-950 text-white text-[10px] py-2 px-6 flex justify-between items-center z-[100] border-b border-white/5">
        <div class="flex items-center gap-3">
            <span class="flex items-center gap-1.5">
                <span class="w-2 h-2 rounded-full bg-green-500 shadow-[0_0_8px_#22c55e]"></span>
                LIVE CORE
            </span>
            <span class="opacity-40">|</span>
            <span>Uptime: 99.99%</span>
            <span class="opacity-40">|</span>
            <span>Active Instance: <span id="roleDisplay" class="text-saffron-400 font-black">CITIZEN</span></span>
        </div>
        <div class="flex gap-6 font-bold uppercase tracking-tighter">
            <button onclick="switchRole('citizen')" class="hover:text-saffron-400 transition cursor-pointer">Citizen</button>
            <button onclick="switchRole('officer')" class="hover:text-saffron-400 transition cursor-pointer">State Officer</button>
            <button onclick="switchRole('admin')" class="hover:text-saffron-400 transition cursor-pointer">National Admin</button>
        </div>
    </div>

    <!-- Official Branding Header -->
    <header class="gradient-header text-white flex-shrink-0 shadow-xl relative z-50">
        <div class="container mx-auto px-6 py-4 flex justify-between items-center">
            <div class="flex items-center gap-6 cursor-pointer group" onclick="navigate('dash')">
                <div class="bg-white p-2 rounded-xl transition-transform group-hover:scale-105 shadow-inner">
                    <img src="https://upload.wikimedia.org/wikipedia/commons/5/55/Emblem_of_India.svg" alt="Emblem" class="h-12">
                </div>
                <div>
                    <h1 class="text-2xl font-extrabold tracking-tighter leading-none">DRISHTI 2.0</h1>
                    <p class="text-[10px] font-bold opacity-70 uppercase mt-1 tracking-[0.2em]">National AI Grievance Ecosystem</p>
                </div>
            </div>
            
            <div class="flex items-center gap-10">
                <div class="hidden xl:flex flex-col items-end">
                    <span id="liveClock" class="text-xs font-mono opacity-80">--:--:--</span>
                    <span class="text-[10px] font-black opacity-60 uppercase tracking-widest" id="liveDate">Loading...</span>
                </div>
                <div class="flex items-center gap-4 pl-8 border-l border-white/10">
                    <div class="text-right hidden sm:block">
                        <p class="text-sm font-black" id="userName">Rahul Sharma</p>
                        <p class="text-[10px] opacity-60 font-bold" id="userTitle">Aadhar Verified Citizen</p>
                    </div>
                    <div id="userAvatar" class="h-11 w-11 bg-orange-500 rounded-2xl flex items-center justify-center font-black text-xl shadow-lg border-2 border-white/20">RS</div>
                </div>
            </div>
        </div>
    </header>

    <div class="flex flex-1 overflow-hidden">
        <!-- Sidebar Navigation -->
        <nav class="w-72 bg-slate-900 text-white flex-shrink-0 flex flex-col border-r border-white/5 shadow-2xl z-40">
            <div class="p-6">
                <p class="text-[10px] font-black text-slate-500 uppercase tracking-widest mb-6">Navigation Control</p>
                <div id="sidebarMenu" class="space-y-1">
                    <!-- Dynamic Items -->
                </div>
            </div>
            
            <div class="mt-auto p-6 space-y-4">
                <div class="p-4 bg-white/5 rounded-xl border border-white/10">
                    <p class="text-[10px] font-bold text-slate-400 mb-2 uppercase">Helpline 24/7</p>
                    <p class="text-lg font-black text-saffron-400">1800-11-2345</p>
                </div>
                <button class="flex items-center gap-3 text-sm font-bold text-slate-500 hover:text-white transition w-full p-2">
                    <i data-lucide="log-out" class="w-5 h-5"></i>
                    Secure Logout
                </button>
            </div>
        </nav>

        <!-- Main Display Content -->
        <main class="flex-1 overflow-y-auto bg-slate-50 custom-scrollbar" id="mainDisplay">
            <!-- Dynamic Content Injected Here -->
        </main>
    </div>
</div>

<!-- Modal Engine Overlay -->
<div id="modalOverlay" class="fixed inset-0 bg-slate-900/80 hidden z-[200] flex items-center justify-center p-6 backdrop-blur-md">
    <div id="modalFrame" class="bg-white rounded-[2rem] shadow-2xl max-w-5xl w-full max-h-[85vh] overflow-y-auto relative animate-view">
        <button onclick="closeModal()" class="sticky top-6 left-[95%] text-slate-300 hover:text-slate-900 z-[210] transition-colors">
            <i data-lucide="x-circle" class="w-10 h-10"></i>
        </button>
        <div id="modalContent" class="p-10 pt-0"></div>
    </div>
</div>

<script>
    // --- SQL-LIKE SESSION DATABASE ---
    const DB = {
        users: {
            citizen: { name: 'Rahul Sharma', id: 'CIT-8821', state: 'Delhi', district: 'South Delhi', avatar: 'RS', role: 'citizen' },
            officer: { name: 'Dr. Vikram Seth', id: 'OFF-4001', state: 'Delhi', dept: 'Electricity', avatar: 'VS', role: 'officer' },
            admin: { name: 'Smt. Kavita Rao', id: 'ADM-0001', state: 'National', dept: 'Central Systems', avatar: 'KR', role: 'admin' }
        },
        complaints: [
            { id: 'GRV-2026-001', userId: 'CIT-8821', title: 'Invalid Electricity Meter Reading', dept: 'Electricity', status: 'In Progress', priority: 'High', date: '2026-01-02', deadline: '2026-01-10', desc: 'My bill for Dec is 5x higher than normal.', state: 'Delhi' },
            { id: 'GRV-2026-002', userId: 'CIT-8821', title: 'Water Pipe Leakage Main Road', dept: 'Water Supply', status: 'Pending', priority: 'Critical', date: '2026-01-05', deadline: '2026-01-08', desc: 'Massive leak causing road damage near Ward 4.', state: 'Delhi' },
            { id: 'GRV-2026-003', userId: 'CIT-9900', title: 'Pothole Repair Request', dept: 'Roads', status: 'Resolved', priority: 'Medium', date: '2025-12-20', deadline: '2025-12-30', desc: 'Repair required near Metro Pillar 114.', state: 'Delhi' }
        ],
        threads: [
            { id: 'T1', title: 'Street lighting in Saket Sector 4', author: 'Suresh Raina', votes: 42, comments: 8, cat: 'Infrastructure' },
            { id: 'T2', title: 'New Garbage Collection Routes', author: 'Megha J.', votes: 15, comments: 22, cat: 'Sanitation' }
        ],
        aiMetrics: { accuracy: 94.8, overrides: 12, totalProcessed: 14500 },
        slaConfig: {
            'Electricity': 48, // hours
            'Water Supply': 24,
            'Roads': 120,
            'Sanitation': 12
        }
    };

    let currentRole = 'citizen';
    let currentUser = DB.users.citizen;
    let activeTab = 'dash';

    // --- ENGINE CORE ---

    function switchRole(role) {
        currentRole = role;
        currentUser = DB.users[role];
        activeTab = role === 'citizen' ? 'dash' : (role === 'officer' ? 'worklist' : 'national');
        
        document.getElementById('roleDisplay').innerText = role.toUpperCase();
        document.getElementById('userName').innerText = currentUser.name;
        document.getElementById('userAvatar').innerText = currentUser.avatar;
        document.getElementById('userTitle').innerText = role === 'admin' ? 'National System Administrator' : (role === 'officer' ? `State Dept Officer (${currentUser.state})` : 'Aadhar Verified Citizen');
        
        renderSidebar();
        navigate(activeTab);
    }

    function renderSidebar() {
        const menu = document.getElementById('sidebarMenu');
        const items = {
            citizen: [
                { id: 'dash', label: 'My Dashboard', icon: 'layout-dashboard' },
                { id: 'lodge', label: 'Lodge Grievance', icon: 'plus-square', special: true },
                { id: 'history', label: 'History & Archive', icon: 'archive' },
                { id: 'community', label: 'Community Hub', icon: 'users-2' },
                { id: 'guidelines', label: 'Govt Guidelines', icon: 'book-open' }
            ],
            officer: [
                { id: 'worklist', label: 'Active Worklist', icon: 'list-checks' },
                { id: 'sla_monitor', label: 'SLA Tracking', icon: 'clock' },
                { id: 'field_maps', label: 'Field Assignments', icon: 'map' },
                { id: 'state_stats', label: 'Analytics Dashboard', icon: 'bar-chart-3' }
            ],
            admin: [
                { id: 'national', label: 'National Dashboard', icon: 'globe' },
                { id: 'dept_audit', label: 'Department Audit', icon: 'shield-check' },
                { id: 'ai_center', label: 'AI Control Center', icon: 'cpu' },
                { id: 'sys_config', label: 'System Config', icon: 'settings-2' }
            ]
        };

        menu.innerHTML = items[currentRole].map(item => `
            <div onclick="navigate('${item.id}')" class="sidebar-item ${activeTab === item.id ? 'active' : ''} ${item.special ? 'text-saffron-400 font-black' : ''}">
                <i data-lucide="${item.icon}" class="w-5 h-5"></i>
                <span class="text-sm font-medium tracking-tight">${item.label}</span>
            </div>
        `).join('');
        
        lucide.createIcons();
    }

    function navigate(id) {
        activeTab = id;
        renderSidebar();
        const display = document.getElementById('mainDisplay');
        display.innerHTML = '<div class="p-20 flex justify-center"><div class="animate-spin h-10 w-10 border-4 border-gov-blue border-t-transparent rounded-full"></div></div>';
        
        setTimeout(() => {
            switch(id) {
                // Citizen Routes
                case 'dash': renderCitizenDashboard(display); break;
                case 'lodge': showLodgeGrievance(); break;
                case 'history': renderHistoryView(display); break;
                case 'community': renderCommunityView(display); break;
                case 'guidelines': renderGuidelinesView(display); break;
                
                // Officer Routes
                case 'worklist': renderOfficerWorklist(display); break;
                case 'sla_monitor': renderSLAMonitor(display); break;
                case 'field_maps': renderFieldMaps(display); break;
                case 'state_stats': renderStateStats(display); break;
                
                // Admin Routes
                case 'national': renderNationalDashboard(display); break;
                case 'dept_audit': renderDeptAudit(display); break;
                case 'ai_center': renderAICenter(display); break;
                case 'sys_config': renderSystemConfig(display); break;
            }
            lucide.createIcons();
        }, 300);
    }

    // --- CITIZEN PAGES ---

    function renderCitizenDashboard(container) {
        const userComplaints = DB.complaints.filter(c => c.userId === currentUser.id);
        const resolved = userComplaints.filter(c => c.status === 'Resolved').length;
        
        container.innerHTML = `
            <div class="p-10 animate-view">
                <div class="mb-10 flex justify-between items-end">
                    <div>
                        <h2 class="text-4xl font-black text-slate-800 tracking-tighter">Citizen Dashboard</h2>
                        <p class="text-slate-500 font-medium mt-1">Grievances filed in ${currentUser.district}, ${currentUser.state}</p>
                    </div>
                    <button onclick="navigate('lodge')" class="bg-gov-saffron text-white px-8 py-4 rounded-2xl font-black shadow-2xl shadow-orange-200 hover:scale-105 active:scale-95 transition-all flex items-center gap-3">
                        <i data-lucide="plus-circle" class="w-6 h-6"></i> NEW GRIEVANCE
                    </button>
                </div>

                <div class="grid grid-cols-1 md:grid-cols-4 gap-6 mb-12">
                    ${renderStatCard('Open Cases', userComplaints.length - resolved, 'blue', 'folder-open')}
                    ${renderStatCard('Resolution Rate', '84%', 'green', 'trending-up')}
                    ${renderStatCard('Resolved Total', resolved, 'indigo', 'check-square')}
                    ${renderStatCard('Average SLA', '2.4 Days', 'orange', 'timer')}
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-10">
                    <div class="lg:col-span-2 gov-card p-8">
                        <div class="flex justify-between items-center mb-8">
                            <h3 class="text-xl font-black text-slate-800 uppercase tracking-widest">Active Cases</h3>
                            <button onclick="navigate('history')" class="text-xs font-bold text-gov-blue hover:underline">View All Archive</button>
                        </div>
                        <div class="space-y-4">
                            ${userComplaints.filter(c => c.status !== 'Resolved').map(c => renderComplaintRow(c)).join('')}
                        </div>
                    </div>
                    <div class="space-y-6">
                        <div class="gov-card p-8 bg-slate-900 text-white border-none">
                            <h3 class="text-sm font-black text-saffron-400 uppercase tracking-widest mb-6">Community Pulse</h3>
                            <div class="space-y-5">
                                ${DB.threads.map(t => `
                                    <div class="group cursor-pointer">
                                        <p class="text-sm font-bold leading-tight group-hover:text-saffron-400 transition-colors">${t.title}</p>
                                        <div class="flex gap-4 mt-2 opacity-50 text-[10px] font-black uppercase">
                                            <span><i data-lucide="thumbs-up" class="inline w-3 h-3 mb-0.5"></i> ${t.votes} Votes</span>
                                            <span><i data-lucide="message-square" class="inline w-3 h-3 mb-0.5"></i> ${t.comments}</span>
                                        </div>
                                    </div>
                                `).join('')}
                            </div>
                        </div>
                        <div class="gov-card p-8 bg-blue-50 border-blue-100">
                            <h4 class="text-xs font-black text-gov-blue uppercase mb-2">Did You Know?</h4>
                            <p class="text-xs leading-relaxed text-blue-800 opacity-80">DRISHTI uses advanced NLP to categorize your grievance in under 2 seconds, ensuring it reaches the correct state department instantly.</p>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function renderHistoryView(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <h2 class="text-3xl font-black text-slate-800 mb-8 tracking-tight">Grievance History & Archive</h2>
                <div class="gov-card overflow-hidden">
                    <div class="p-6 bg-slate-50 border-b flex gap-4">
                        <input type="text" placeholder="Search by ID or Title..." class="flex-1 bg-white border border-slate-200 rounded-xl px-4 py-2 text-sm">
                        <select class="border rounded-xl px-4 py-2 text-sm"><option>All Categories</option></select>
                        <select class="border rounded-xl px-4 py-2 text-sm"><option>Sort: Newest First</option></select>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50 text-[10px] uppercase font-black text-slate-400 tracking-widest">
                                <tr>
                                    <th class="px-8 py-4">Complaint ID</th>
                                    <th class="px-8 py-4">Title & Subject</th>
                                    <th class="px-8 py-4">Department</th>
                                    <th class="px-8 py-4">Status</th>
                                    <th class="px-8 py-4 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y">
                                ${DB.complaints.map(c => `
                                    <tr class="hover:bg-slate-50 transition-colors cursor-pointer">
                                        <td class="px-8 py-5 font-mono text-xs font-bold text-slate-400">${c.id}</td>
                                        <td class="px-8 py-5">
                                            <p class="text-sm font-black text-slate-800">${c.title}</p>
                                            <p class="text-[10px] text-slate-400 font-medium">Filed: ${c.date}</p>
                                        </td>
                                        <td class="px-8 py-5 text-xs font-bold text-slate-600 uppercase">${c.dept}</td>
                                        <td class="px-8 py-5">
                                            <span class="status-pill ${c.status === 'Resolved' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">${c.status}</span>
                                        </td>
                                        <td class="px-8 py-5 text-right">
                                            <button onclick="viewCaseDetail('${c.id}')" class="text-gov-blue font-black text-[10px] uppercase hover:underline">View File</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `;
    }

    function renderCommunityView(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <div class="flex justify-between items-center mb-10">
                    <h2 class="text-3xl font-black text-slate-800 tracking-tight">Community Forum</h2>
                    <button class="bg-gov-blue text-white px-6 py-2 rounded-xl text-xs font-black shadow-lg">START DISCUSSION</button>
                </div>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-8">
                    ${DB.threads.map(t => `
                        <div class="gov-card p-8 group">
                            <div class="flex justify-between items-start mb-6">
                                <span class="bg-slate-100 px-3 py-1 rounded text-[10px] font-black text-slate-500 uppercase">${t.cat}</span>
                                <div class="flex items-center gap-1.5 text-slate-300 font-bold text-xs"><i data-lucide="thumbs-up" class="w-4 h-4"></i> ${t.votes}</div>
                            </div>
                            <h4 class="text-xl font-black text-slate-800 mb-2 leading-tight group-hover:text-gov-blue transition-colors">${t.title}</h4>
                            <p class="text-xs text-slate-400 font-medium mb-6">Started by <span class="text-slate-600 font-bold">${t.author}</span> • 2 days ago</p>
                            <div class="flex justify-between items-center pt-6 border-t border-slate-100">
                                <span class="text-[10px] font-black text-gov-blue uppercase">${t.comments} OFFICIAL REPLIES</span>
                                <button class="text-[10px] font-black text-slate-400 hover:text-gov-blue uppercase">Join Conversation →</button>
                            </div>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    function renderGuidelinesView(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <h2 class="text-3xl font-black text-slate-800 mb-10 tracking-tight">Official Citizen Guidelines</h2>
                <div class="grid grid-cols-1 md:grid-cols-3 gap-8">
                    ${['Filing a Complaint', 'Tracking Status', 'Escalation Rules'].map(title => `
                        <div class="gov-card p-8">
                            <div class="h-12 w-12 bg-blue-50 text-gov-blue rounded-xl flex items-center justify-center mb-6"><i data-lucide="book" class="w-6 h-6"></i></div>
                            <h4 class="text-lg font-black text-slate-800 mb-4">${title}</h4>
                            <p class="text-xs text-slate-500 leading-relaxed mb-6">Detailed instructions on how the digital governance model handles ${title.toLowerCase()} via the DRISHTI platform.</p>
                            <button class="text-xs font-black text-gov-blue uppercase hover:tracking-widest transition-all">Download PDF →</button>
                        </div>
                    `).join('')}
                </div>
            </div>
        `;
    }

    // --- OFFICER PAGES ---

    function renderOfficerWorklist(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <div class="mb-10 flex justify-between items-end">
                    <div>
                        <h2 class="text-3xl font-black text-slate-800 uppercase tracking-tighter">Field Worklist</h2>
                        <p class="text-slate-500 font-bold">Region: ${currentUser.state} Central Hub</p>
                    </div>
                </div>
                <div class="gov-card overflow-hidden">
                    <div class="p-4 bg-slate-50 flex gap-4 border-b">
                        <button class="text-xs font-black text-gov-blue border-b-2 border-gov-blue pb-1">All Assigned</button>
                        <button class="text-xs font-bold text-slate-400 pb-1">Urgent Only</button>
                    </div>
                    <div class="overflow-x-auto">
                        <table class="w-full text-left">
                            <thead class="bg-slate-50/50 text-[10px] uppercase font-black text-slate-400">
                                <tr>
                                    <th class="px-8 py-5">Case ID</th>
                                    <th class="px-8 py-5">AI Priority</th>
                                    <th class="px-8 py-5">Aging (Time)</th>
                                    <th class="px-8 py-5">Status</th>
                                    <th class="px-8 py-5 text-right">Action</th>
                                </tr>
                            </thead>
                            <tbody class="divide-y">
                                ${DB.complaints.map(c => `
                                    <tr class="hover:bg-slate-50/80 transition-all">
                                        <td class="px-8 py-5 font-mono text-xs font-bold text-slate-400">${c.id}</td>
                                        <td class="px-8 py-5">
                                            <div class="flex items-center gap-2">
                                                <span class="w-2.5 h-2.5 rounded-full ${c.priority === 'Critical' ? 'bg-red-500 animate-pulse' : 'bg-orange-500'}"></span>
                                                <span class="text-sm font-black text-slate-800">${c.priority}</span>
                                            </div>
                                        </td>
                                        <td class="px-8 py-5 text-sm font-bold text-slate-500 italic">2h 14m left</td>
                                        <td class="px-8 py-5">
                                            <span class="px-3 py-1 bg-blue-100 text-blue-700 rounded text-[10px] font-black uppercase">${c.status}</span>
                                        </td>
                                        <td class="px-8 py-5 text-right">
                                            <button onclick="handleCase('${c.id}')" class="bg-gov-blue text-white px-5 py-2 rounded-xl text-[10px] font-black shadow-lg">MANAGE FILE</button>
                                        </td>
                                    </tr>
                                `).join('')}
                            </tbody>
                        </table>
                    </div>
                </div>
            </div>
        `;
    }

    function renderSLAMonitor(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <h2 class="text-3xl font-black text-slate-800 mb-10 tracking-tight">SLA Performance Tracker</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-4 gap-6 mb-12">
                    ${renderStatCard('On-Time', '92%', 'green', 'check')}
                    ${renderStatCard('Late/Overdue', '4', 'red', 'alert-triangle')}
                    ${renderStatCard('Avg Response', '1.2h', 'blue', 'zap')}
                    ${renderStatCard('Breach Risk', 'High', 'orange', 'shield-alert')}
                </div>
                <div class="gov-card p-10">
                    <h3 class="text-lg font-black mb-8 uppercase text-slate-700 tracking-widest">Breach Warning List</h3>
                    <div class="space-y-4">
                        <div class="flex items-center justify-between p-6 bg-red-50 border border-red-100 rounded-2xl">
                            <div class="flex items-center gap-6">
                                <div class="bg-red-500 text-white p-3 rounded-xl font-black text-xl">14m</div>
                                <div>
                                    <p class="text-sm font-black">GRV-2026-002: Water Leakage</p>
                                    <p class="text-[10px] font-bold text-red-400">Escalation path active in 14 minutes</p>
                                </div>
                            </div>
                            <button class="bg-red-600 text-white px-4 py-2 rounded-xl text-[10px] font-black">INTERVENE NOW</button>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function renderFieldMaps(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <h2 class="text-3xl font-black text-slate-800 mb-10 tracking-tight">Geographic Field Mapping</h2>
                <div class="gov-card h-[600px] flex flex-col items-center justify-center bg-slate-100 border-2 border-dashed border-slate-300">
                    <i data-lucide="map-pin" class="w-20 h-20 text-slate-300 mb-6"></i>
                    <p class="text-xl font-black text-slate-400 uppercase tracking-tighter">Live GIS Integration In-Progress</p>
                    <p class="text-sm text-slate-400 font-bold mt-2">Displaying complaint hotspots across ${currentUser.state} clusters</p>
                </div>
            </div>
        `;
    }

    function renderStateStats(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <h2 class="text-3xl font-black text-slate-800 mb-10 tracking-tight">State Efficiency Analytics</h2>
                <div class="grid grid-cols-1 lg:grid-cols-2 gap-10">
                    <div class="gov-card p-8">
                        <h4 class="text-sm font-black uppercase text-slate-500 mb-8">Resolution Trends (Weekly)</h4>
                        <div class="h-80"><canvas id="stateTrends"></canvas></div>
                    </div>
                    <div class="gov-card p-8">
                        <h4 class="text-sm font-black uppercase text-slate-500 mb-8">Departmental Aging</h4>
                        <div class="h-80"><canvas id="stateAging"></canvas></div>
                    </div>
                </div>
            </div>
        `;
        setTimeout(() => {
            const ctx1 = document.getElementById('stateTrends').getContext('2d');
            new Chart(ctx1, {
                type: 'line',
                data: { labels: ['M','T','W','T','F','S','S'], datasets: [{ label:'Resolved', data:[12,19,15,22,30,10,5], borderColor:'#0b4a8f', tension:0.4 }] },
                options: { maintainAspectRatio: false }
            });
            const ctx2 = document.getElementById('stateAging').getContext('2d');
            new Chart(ctx2, {
                type: 'bar',
                data: { labels: ['Water','Elec','Road','Sanit'], datasets: [{ label:'Avg Days', data:[1.2, 0.8, 4.5, 0.5], backgroundColor:'#f39200' }] },
                options: { maintainAspectRatio: false }
            });
        }, 100);
    }

    // --- ADMIN PAGES ---

    function renderNationalDashboard(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <h2 class="text-4xl font-black text-slate-800 mb-10 tracking-tighter uppercase">National Oversight Dashboard</h2>
                <div class="grid grid-cols-1 lg:grid-cols-3 gap-8 mb-10">
                    <div class="lg:col-span-2 gov-card p-10">
                        <h4 class="text-sm font-black uppercase text-slate-400 mb-10 tracking-widest">Grievance Inflow by Region</h4>
                        <div class="h-96"><canvas id="nationalMap"></canvas></div>
                    </div>
                    <div class="space-y-6">
                        ${renderStatCard('Total Volume', '1.2M', 'indigo', 'globe-2')}
                        ${renderStatCard('State Success', 'UP: 98%', 'green', 'trophy')}
                        ${renderStatCard('Pending Audit', '12', 'orange', 'search')}
                        <div class="gov-card p-8 bg-slate-900 text-white">
                            <h4 class="text-xs font-black text-saffron-400 uppercase mb-4">Critical System Alerts</h4>
                            <div class="space-y-4">
                                <div class="p-3 border border-white/10 rounded-xl bg-white/5">
                                    <p class="text-[10px] font-black text-red-400 uppercase">Latency Warning</p>
                                    <p class="text-xs font-bold">API cluster Mumbai-B showing 250ms delay.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        setTimeout(() => {
            const ctx = document.getElementById('nationalMap').getContext('2d');
            new Chart(ctx, {
                type: 'bar',
                data: { labels: ['Delhi','MH','UP','KA','TN','BR'], datasets: [{ label:'Volume', data:[120,450,980,310,220,540], backgroundColor:'#0b4a8f' }] },
                options: { maintainAspectRatio: false }
            });
        }, 100);
    }

    function renderDeptAudit(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <h2 class="text-3xl font-black text-slate-800 mb-10 tracking-tight">Departmental Audit Engine</h2>
                <div class="gov-card p-10">
                    <table class="w-full text-left">
                        <thead class="text-[10px] font-black uppercase text-slate-400">
                            <tr>
                                <th class="pb-6">Department Name</th>
                                <th class="pb-6">Compliance %</th>
                                <th class="pb-6">Citizen Feedback</th>
                                <th class="pb-6">AI Accuracy</th>
                            </tr>
                        </thead>
                        <tbody class="divide-y">
                            ${['Water','Electricity','Telecom','Roads'].map(d => `
                                <tr>
                                    <td class="py-6 font-black text-slate-800">${d}</td>
                                    <td class="py-6 font-bold text-gov-green">98.2%</td>
                                    <td class="py-6 text-sm">4.8/5</td>
                                    <td class="py-6 font-mono text-xs font-bold text-slate-500">99.1%</td>
                                </tr>
                            `).join('')}
                        </tbody>
                    </table>
                </div>
            </div>
        `;
    }

    function renderAICenter(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <h2 class="text-3xl font-black text-slate-800 mb-10 tracking-tight">AI Control & Audit</h2>
                <div class="grid grid-cols-1 md:grid-cols-2 gap-10">
                    <div class="gov-card p-10">
                        <h4 class="text-sm font-black uppercase text-slate-400 mb-8">NLP Categorization Precision</h4>
                        <div class="h-80"><canvas id="aiChart"></canvas></div>
                    </div>
                    <div class="gov-card p-10 bg-slate-800 text-white border-none">
                        <h4 class="text-sm font-black text-saffron-400 uppercase mb-8">Model Hyperparameters</h4>
                        <div class="space-y-6">
                            ${['Triage-BERT-v4', 'Sentiment-Risk-v2', 'AutoRoute-G-v1'].map(m => `
                                <div class="flex justify-between items-center border-b border-white/5 pb-4">
                                    <span class="text-sm font-bold tracking-tight">${m}</span>
                                    <span class="text-[10px] font-black bg-blue-500 text-white px-2 py-1 rounded">STABLE</span>
                                </div>
                            `).join('')}
                        </div>
                    </div>
                </div>
            </div>
        `;
        setTimeout(() => {
            const ctx = document.getElementById('aiChart').getContext('2d');
            new Chart(ctx, {
                type: 'doughnut',
                data: { labels: ['Correct','Override','Low Conf'], datasets: [{ data:[94,4,2], backgroundColor:['#22c55e','#ef4444','#f39200'] }] },
                options: { maintainAspectRatio: false }
            });
        }, 100);
    }

    function renderSystemConfig(container) {
        container.innerHTML = `
            <div class="p-10 animate-view">
                <h2 class="text-3xl font-black text-slate-800 mb-10 tracking-tight">Global System Configuration</h2>
                <div class="gov-card p-10">
                    <h4 class="text-sm font-black uppercase text-slate-500 mb-8">Department SLA Targets (Hours)</h4>
                    <div class="grid grid-cols-1 md:grid-cols-2 lg:grid-cols-3 gap-6">
                        ${Object.keys(DB.slaConfig).map(dept => `
                            <div class="p-6 bg-slate-50 rounded-2xl border border-slate-200">
                                <label class="text-[10px] font-black uppercase text-slate-400">${dept}</label>
                                <div class="flex items-center gap-4 mt-2">
                                    <input type="number" value="${DB.slaConfig[dept]}" class="w-20 bg-white border rounded-xl p-2 font-black text-gov-blue">
                                    <span class="text-xs font-bold text-slate-500">HRS</span>
                                </div>
                            </div>
                        `).join('')}
                    </div>
                    <div class="mt-12 flex justify-end">
                        <button class="bg-gov-blue text-white px-10 py-4 rounded-2xl font-black shadow-xl">SAVE CORE CONFIG</button>
                    </div>
                </div>
            </div>
        `;
    }

    // --- SHARED UI COMPONENTS ---

    function renderStatCard(label, val, color, icon) {
        const theme = {
            blue: 'border-blue-500 text-blue-600 bg-blue-50/50',
            green: 'border-green-500 text-green-600 bg-green-50/50',
            indigo: 'border-indigo-500 text-indigo-600 bg-indigo-50/50',
            orange: 'border-orange-500 text-orange-600 bg-orange-50/50',
            red: 'border-red-500 text-red-600 bg-red-50/50'
        }[color];
        
        return `
            <div class="gov-card p-6 border-l-[6px] ${theme}">
                <div class="flex justify-between items-start">
                    <div>
                        <p class="text-[10px] font-black uppercase opacity-60 tracking-widest mb-2">${label}</p>
                        <h3 class="text-3xl font-black tracking-tighter">${val}</h3>
                    </div>
                    <div class="p-3 bg-white/60 rounded-xl shadow-sm"><i data-lucide="${icon}" class="w-6 h-6"></i></div>
                </div>
            </div>
        `;
    }

    function renderComplaintRow(c) {
        return `
            <div class="p-6 border rounded-2xl hover:bg-slate-50 transition-all cursor-pointer group" onclick="viewCaseDetail('${c.id}')">
                <div class="flex justify-between items-start mb-4">
                    <div class="flex items-center gap-3">
                        <span class="bg-slate-100 text-slate-500 px-2 py-0.5 rounded font-mono text-[9px] font-black">${c.id}</span>
                        <h4 class="font-bold text-slate-800 group-hover:text-gov-blue transition-colors">${c.title}</h4>
                    </div>
                    <span class="status-pill ${c.status === 'Resolved' ? 'bg-green-100 text-green-700' : 'bg-blue-100 text-blue-700'}">${c.status}</span>
                </div>
                <div class="flex justify-between items-center text-[10px] font-black uppercase tracking-wider text-slate-400">
                    <div class="flex gap-6">
                        <span class="flex items-center gap-1.5"><i data-lucide="tag" class="w-3.5 h-3.5"></i> ${c.dept}</span>
                        <span class="flex items-center gap-1.5"><i data-lucide="map-pin" class="w-3.5 h-3.5"></i> ${c.state}</span>
                    </div>
                    <div class="flex items-center gap-3">
                        <span class="text-red-500">BREACH: ${c.deadline}</span>
                        <div class="w-24 h-1.5 bg-slate-200 rounded-full overflow-hidden">
                            <div class="bg-gov-blue h-full" style="width: 70%"></div>
                        </div>
                    </div>
                </div>
            </div>
        `;
    }

    function showLodgeGrievance() {
        const modal = document.getElementById('modalContent');
        modal.innerHTML = `
            <div class="pt-10 mb-12 text-center">
                <div class="h-20 w-20 bg-blue-100 text-gov-blue rounded-3xl flex items-center justify-center mx-auto mb-6 shadow-inner">
                    <i data-lucide="plus" class="w-10 h-10"></i>
                </div>
                <h2 class="text-3xl font-black text-slate-800 tracking-tighter uppercase">Lodge National Grievance</h2>
                <p class="text-slate-500 font-bold mt-2">Authenticated via Aadhar Virtual ID: ****-****-9921</p>
            </div>

            <div class="grid grid-cols-1 lg:grid-cols-5 gap-12">
                <div class="lg:col-span-3 space-y-8">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Grievance Title</label>
                        <input id="lod_title" type="text" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl p-5 font-bold focus:border-gov-blue outline-none transition" placeholder="Short summary of the issue...">
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Incident Description</label>
                        <textarea id="lod_desc" rows="6" class="w-full bg-slate-50 border-2 border-slate-100 rounded-2xl p-5 font-bold focus:border-gov-blue outline-none transition" placeholder="Please provide specific details. AI will automatically route your case..." onblur="simulateAITriage()"></textarea>
                    </div>
                    <div id="aiTriagePanel" class="hidden bg-slate-900 text-white p-8 rounded-3xl shadow-2xl ai-glow animate-view">
                        <div class="flex items-center gap-4 mb-4">
                            <i data-lucide="cpu" class="text-saffron-400 w-6 h-6 animate-pulse"></i>
                            <span class="text-xs font-black uppercase tracking-[0.2em] text-saffron-400">AI Triage Active</span>
                        </div>
                        <p class="text-xs opacity-70 leading-relaxed italic" id="aiTriageMsg">Analyzing natural language patterns for departmental routing...</p>
                    </div>
                </div>
                <div class="lg:col-span-2 space-y-8">
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Routing Department (Auto)</label>
                        <select id="lod_dept" class="w-full bg-slate-100 border-2 border-slate-100 rounded-2xl p-5 font-black text-gov-blue outline-none appearance-none">
                            <option>Awaiting Triage...</option>
                            <option>Electricity</option>
                            <option>Water Supply</option>
                            <option>Sanitation</option>
                        </select>
                    </div>
                    <div class="space-y-2">
                        <label class="text-[10px] font-black uppercase text-slate-400 tracking-widest ml-1">Evidence Upload</label>
                        <div class="border-4 border-dashed border-slate-100 rounded-3xl h-44 flex flex-col items-center justify-center text-slate-300 hover:text-gov-blue hover:bg-blue-50 transition cursor-pointer">
                            <i data-lucide="camera" class="w-10 h-10 mb-2"></i>
                            <span class="text-xs font-black uppercase">Click to Attach Files</span>
                        </div>
                    </div>
                    <div class="pt-6 grid grid-cols-2 gap-4">
                        <button onclick="closeModal()" class="px-6 py-4 border-2 border-slate-100 rounded-2xl font-black text-slate-400 hover:bg-slate-50 transition">DISCARD</button>
                        <button onclick="submitGrievance()" class="px-6 py-4 bg-gov-blue text-white rounded-2xl font-black shadow-2xl hover:scale-105 transition">LODGE FILE</button>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('modalOverlay').classList.remove('hidden');
        lucide.createIcons();
    }

    function simulateAITriage() {
        const desc = document.getElementById('lod_desc').value;
        if (desc.length < 20) return;
        
        const panel = document.getElementById('aiTriagePanel');
        panel.classList.remove('hidden');
        
        setTimeout(() => {
            document.getElementById('aiTriageMsg').innerHTML = `Detected: <span class="text-white font-black">Infrastructure / Utility Leakage</span>. Suggested Urgency: <span class="text-white font-black">HIGH</span>. Routing to <span class="text-saffron-400 font-black">Water Supply Dept</span>.`;
            document.getElementById('lod_dept').value = "Water Supply";
        }, 1500);
    }

    function submitGrievance() {
        const title = document.getElementById('lod_title').value || "New Grievance";
        const id = 'GRV-2026-00' + (DB.complaints.length + 1);
        DB.complaints.unshift({
            id: id,
            userId: currentUser.id,
            title: title,
            dept: document.getElementById('lod_dept').value,
            status: 'Pending',
            priority: 'Medium',
            date: '2026-01-08',
            deadline: '2026-01-12',
            desc: document.getElementById('lod_desc').value,
            state: currentUser.state
        });
        closeModal();
        navigate('dash');
        showNotify('SUCCESS: Grievance ' + id + ' initialized and routed.');
    }

    function viewCaseDetail(id) {
        const c = DB.complaints.find(comp => comp.id === id);
        const modal = document.getElementById('modalContent');
        modal.innerHTML = `
            <div class="pt-10">
                <div class="flex flex-col md:flex-row justify-between items-start gap-10 mb-12">
                    <div>
                        <div class="flex items-center gap-4 mb-3">
                            <span class="bg-gov-blue text-white px-4 py-1.5 rounded-xl font-black text-[10px] tracking-widest">${c.id}</span>
                            <span class="status-pill bg-slate-100 text-slate-500 border border-slate-200">${c.dept}</span>
                        </div>
                        <h2 class="text-4xl font-black text-slate-800 tracking-tighter leading-tight">${c.title}</h2>
                    </div>
                    <div class="text-right">
                        <p class="text-[10px] font-black uppercase text-slate-400 mb-2">Live Case Status</p>
                        <span class="status-pill bg-blue-100 text-blue-700 font-black text-sm px-6 py-2 shadow-sm">${c.status}</span>
                    </div>
                </div>

                <div class="grid grid-cols-1 lg:grid-cols-3 gap-12">
                    <div class="lg:col-span-2 space-y-10">
                        <div class="bg-slate-50 p-8 rounded-3xl border-l-[10px] border-slate-300">
                            <h4 class="text-[10px] font-black uppercase text-slate-400 mb-6 tracking-widest">Original Description</h4>
                            <p class="text-slate-700 leading-relaxed italic font-medium">"${c.desc}"</p>
                        </div>
                        
                        <div>
                            <h4 class="text-[10px] font-black uppercase text-slate-400 mb-8 tracking-widest">Digital Audit Trail</h4>
                            <div class="space-y-10 pl-6">
                                ${renderTimelineItem('Complaint Lodged', '08 Jan 2026, 10:15 AM', 'Case initialized via Digital India gateway.', true)}
                                ${renderTimelineItem('AI Triage Completed', '08 Jan 2026, 10:15 AM', 'Automatically routed to ' + c.dept + ' based on NLP analysis.', true)}
                                ${renderTimelineItem('Officer Acknowledgement', 'Scheduled', 'Awaiting field officer assignment.', false)}
                            </div>
                        </div>
                    </div>

                    <div class="space-y-6">
                        <div class="gov-card p-8 border-t-8 border-red-500">
                            <h4 class="text-[10px] font-black uppercase text-slate-400 mb-4 tracking-widest">SLA Deadline</h4>
                            <div class="text-center">
                                <p class="text-5xl font-black text-red-600 tracking-tighter mb-1">02:14:55</p>
                                <p class="text-[10px] font-black text-slate-400 uppercase">Hours remaining</p>
                            </div>
                        </div>
                        <div class="gov-card p-8">
                            <h4 class="text-[10px] font-black uppercase text-slate-400 mb-6 tracking-widest">Stakeholder Info</h4>
                            <div class="flex items-center gap-4">
                                <div class="h-12 w-12 bg-slate-200 rounded-2xl flex items-center justify-center font-black">VS</div>
                                <div>
                                    <p class="text-sm font-black text-slate-800">Dr. Vikram Seth</p>
                                    <p class="text-[10px] font-bold text-slate-400">EE, South Delhi Dept.</p>
                                </div>
                            </div>
                        </div>
                    </div>
                </div>
            </div>
        `;
        document.getElementById('modalOverlay').classList.remove('hidden');
        lucide.createIcons();
    }

    function renderTimelineItem(title, date, msg, done) {
        return `
            <div class="relative pl-12 pb-4">
                <div class="absolute left-0 top-0 h-6 w-6 rounded-full ${done ? 'bg-gov-green text-white shadow-[0_0_10px_#22c55e]' : 'bg-slate-200 text-slate-400'} flex items-center justify-center z-10">
                    <i data-lucide="${done ? 'check' : 'circle'}" class="w-3 h-3"></i>
                </div>
                ${!done ? '' : '<div class="absolute left-3 top-6 bottom-0 w-[2px] bg-gov-green/20"></div>'}
                <div>
                    <div class="flex justify-between items-center mb-1">
                        <h5 class="text-sm font-black ${done ? 'text-slate-800' : 'text-slate-300'}">${title}</h5>
                        <span class="text-[10px] font-bold text-slate-400 uppercase">${date}</span>
                    </div>
                    <p class="text-xs text-slate-500 font-medium">${msg}</p>
                </div>
            </div>
        `;
    }

    function closeModal() {
        document.getElementById('modalOverlay').classList.add('hidden');
    }

    function showNotify(msg) {
        const note = document.createElement('div');
        note.className = 'fixed bottom-10 left-1/2 -translate-x-1/2 bg-slate-950 text-white px-10 py-5 rounded-[2rem] shadow-2xl z-[300] font-black text-xs tracking-widest uppercase animate-view flex items-center gap-4';
        note.innerHTML = `<i data-lucide="shield-check" class="text-green-500"></i> ${msg}`;
        document.body.appendChild(note);
        lucide.createIcons();
        setTimeout(() => note.remove(), 4000);
    }

    function toggleAIChat() {
        const chat = document.getElementById('chatWindow');
        chat.classList.toggle('hidden');
    }

    // --- SYSTEM INIT ---

    window.onload = () => {
        switchRole('citizen');
        
        // Live Date/Time
        setInterval(() => {
            const now = new Date();
            document.getElementById('liveClock').innerText = now.toLocaleTimeString();
            document.getElementById('liveDate').innerText = now.toLocaleDateString('en-GB', { day: '2-digit', month: 'short', year: 'numeric' });
        }, 1000);
    };
</script>

</body>
</html>

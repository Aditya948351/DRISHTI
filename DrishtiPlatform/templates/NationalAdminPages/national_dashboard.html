{% extends 'dashboard_base.html' %}
{% load static %}

{% block title %}National Dashboard | Drishti{% endblock %}

{% block content %}
<div class="container-fluid px-4">
    <!-- Header -->
    <div class="d-flex justify-content-between align-items-center mb-5">
        <div>
            <h1 class="h3 fw-bold text-primary text-uppercase letter-spacing-2 mb-1">National Grievance Command Center
            </h1>
            <p class="text-muted mb-0">Monitoring Pan-India Grievance Redressal & Policy Impact</p>
        </div>
        <div>
            <button class="btn btn-outline-primary me-2"><i data-lucide="download" class="w-4 h-4 me-2"></i>Export
                Report</button>
            <button class="btn btn-primary"><i data-lucide="refresh-cw" class="w-4 h-4 me-2"></i>Refresh Data</button>
        </div>
    </div>

    <!-- KPI Cards -->
    <div class="row g-4 mb-5">
        <div class="col-md-3">
            <div class="card border-0 shadow-sm text-center h-100 py-4 card-hover">
                <div class="card-body">
                    <h6 class="text-uppercase text-muted small fw-bold mb-2">Total Grievances</h6>
                    <h2 class="display-5 fw-bold text-primary mb-0">1.2M</h2>
                    <span class="badge bg-success bg-opacity-10 text-success mt-2 rounded-pill px-3">
                        <i data-lucide="arrow-up" class="w-3 h-3"></i> 5% vs last month
                    </span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm text-center h-100 py-4 card-hover">
                <div class="card-body">
                    <h6 class="text-uppercase text-muted small fw-bold mb-2">Resolution Rate</h6>
                    <h2 class="display-5 fw-bold text-success mb-0">92%</h2>
                    <span class="badge bg-success bg-opacity-10 text-success mt-2 rounded-pill px-3">
                        <i data-lucide="check" class="w-3 h-3"></i> Above Target
                    </span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm text-center h-100 py-4 card-hover">
                <div class="card-body">
                    <h6 class="text-uppercase text-muted small fw-bold mb-2">Avg Turnaround</h6>
                    <h2 class="display-5 fw-bold text-info mb-0">5 Days</h2>
                    <span class="badge bg-info bg-opacity-10 text-info mt-2 rounded-pill px-3">
                        <i data-lucide="clock" class="w-3 h-3"></i> Optimized
                    </span>
                </div>
            </div>
        </div>
        <div class="col-md-3">
            <div class="card border-0 shadow-sm text-center h-100 py-4 card-hover">
                <div class="card-body">
                    <h6 class="text-uppercase text-muted small fw-bold mb-2">Citizen Satisfaction</h6>
                    <h2 class="display-5 fw-bold text-warning mb-0">4.5/5</h2>
                    <span class="badge bg-warning bg-opacity-10 text-warning mt-2 rounded-pill px-3">
                        <i data-lucide="star" class="w-3 h-3"></i> Excellent
                    </span>
                </div>
            </div>
        </div>
    </div>

    <!-- Analytics Section -->
    <div class="row g-4 mb-5">
        <!-- State Performance Chart -->
        <div class="col-lg-8">
            <div class="card border-0 shadow-sm h-100">
                <div class="card-header bg-white py-3 d-flex justify-content-between align-items-center">
                    <h5 class="fw-bold mb-0 text-dark">
                        <i data-lucide="bar-chart-2" class="w-5 h-5 me-2 text-primary"></i>State-wise Performance
                    </h5>
                    <select class="form-select form-select-sm w-auto">
                        <option>Last 30 Days</option>
                        <option>Last Quarter</option>
                        <option>YTD</option>
                    </select>
                </div>
                <div class="card-body">
                    <canvas id="stateChart" height="300"></canvas>
                </div>
            </div>
        </div>

        <!-- AI Insights -->
        <div class="col-lg-4">
            <div class="card border-0 shadow-sm h-100 bg-dark text-white position-relative overflow-hidden">
                <div class="position-absolute top-0 end-0 p-3 opacity-10">
                    <i data-lucide="cpu" class="w-24 h-24"></i>
                </div>
                <div class="card-body p-4">
                    <h5 class="fw-bold mb-4 border-bottom border-secondary pb-3">
                        <i data-lucide="sparkles" class="w-5 h-5 me-2 text-warning"></i>AI Policy Insights
                    </h5>

                    <div class="mb-4">
                        <h6 class="text-info small text-uppercase fw-bold mb-2">Top Issue Identified</h6>
                        <p class="mb-1 fw-bold fs-5">Rural Sanitation Infrastructure</p>
                        <p class="small opacity-75">
                            Clustering algorithms identified 15,000+ similar complaints across 3 states. Suggests
                            systemic infrastructure gap.
                        </p>
                    </div>

                    <div class="mb-4">
                        <h6 class="text-info small text-uppercase fw-bold mb-2">Predicted Impact</h6>
                        <p class="mb-1 fw-bold fs-5">Monsoon Preparedness</p>
                        <p class="small opacity-75">
                            Predictive models suggest 20% increase in drainage complaints next month. Recommended
                            pre-emptive maintenance.
                        </p>
                    </div>

                    <button class="btn btn-light w-100 rounded-pill fw-bold text-dark mt-auto">
                        Generate Policy Brief
                    </button>
                </div>
            </div>
        </div>
    </div>

    <!-- State Leaderboard -->
    <div class="card border-0 shadow-sm mb-5">
        <div class="card-header bg-white py-3">
            <h5 class="fw-bold mb-0">State Performance Leaderboard</h5>
        </div>
        <div class="table-responsive">
            <table class="table table-hover align-middle mb-0">
                <thead class="bg-light text-uppercase small fw-bold text-muted">
                    <tr>
                        <th class="px-4 py-3">Rank</th>
                        <th class="px-4 py-3">State</th>
                        <th class="px-4 py-3">Resolution Rate</th>
                        <th class="px-4 py-3">Citizen Feedback</th>
                        <th class="px-4 py-3">Status</th>
                    </tr>
                </thead>
                <tbody>
                    <tr>
                        <td class="px-4 fw-bold">1</td>
                        <td class="px-4">Maharashtra</td>
                        <td class="px-4">96%</td>
                        <td class="px-4">
                            <div class="d-flex text-warning">
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star-half" class="w-4 h-4 fill-current"></i>
                            </div>
                        </td>
                        <td class="px-4"><span class="badge bg-success">Excellent</span></td>
                    </tr>
                    <tr>
                        <td class="px-4 fw-bold">2</td>
                        <td class="px-4">Karnataka</td>
                        <td class="px-4">94%</td>
                        <td class="px-4">
                            <div class="d-flex text-warning">
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                            </div>
                        </td>
                        <td class="px-4"><span class="badge bg-success">Very Good</span></td>
                    </tr>
                    <tr>
                        <td class="px-4 fw-bold">3</td>
                        <td class="px-4">Delhi</td>
                        <td class="px-4">91%</td>
                        <td class="px-4">
                            <div class="d-flex text-warning">
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                                <i data-lucide="star" class="w-4 h-4 fill-current"></i>
                            </div>
                        </td>
                        <td class="px-4"><span class="badge bg-success">Good</span></td>
                    </tr>
                </tbody>
            </table>
        </div>
    </div>
</div>
{% endblock %}

{% block extra_js %}
<script src="https://cdn.jsdelivr.net/npm/chart.js"></script>
<script>
    // Simulated State Data
    const ctx = document.getElementById('stateChart').getContext('2d');
    new Chart(ctx, {
        type: 'bar',
        data: {
            labels: ['Maharashtra', 'Karnataka', 'Delhi', 'Tamil Nadu', 'UP', 'Gujarat'],
            datasets: [{
                label: 'Complaints Resolved',
                data: [4500, 3800, 3200, 2900, 2100, 1800],
                backgroundColor: '#0b4a8f',
                borderRadius: 4
            }, {
                label: 'Pending',
                data: [200, 300, 400, 150, 600, 250],
                backgroundColor: '#f39200',
                borderRadius: 4
            }]
        },
        options: {
            responsive: true,
            plugins: {
                legend: { position: 'top' },
                title: { display: false }
            },
            scales: {
                y: { beginAtZero: true }
            }
        }
    });
</script>
{% endblock %}